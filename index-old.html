<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>George and Frankie's Dream Team Builder Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 1200px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 30px;
        }

        .game-modes {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .mode-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .mode-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .mode-button.active {
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
        }

        .setup-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .setup-step h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .player-count-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .count-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 1em;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .count-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .count-button.selected {
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
        }

        .player-name-inputs {
            display: grid;
            gap: 15px;
            max-width: 400px;
            margin: 0 auto 20px;
        }

        .name-input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            text-align: center;
        }

        .name-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .start-button {
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .start-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .game-type-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .type-button {
            background: white;
            border: 3px solid #ddd;
            padding: 25px 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-width: 200px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .type-button:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .type-button strong {
            display: block;
            font-size: 1.2em;
            margin-bottom: 8px;
            color: #333;
        }
        
        .type-button small {
            color: #666;
            font-size: 0.9em;
        }
        
        .invite-link-container {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .invite-link-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
            background: white;
        }
        
        .copy-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }
        
        .copy-button:hover {
            background: #218838;
        }
        
        .invite-instructions {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.9em;
        }
        
        .joined-players {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .joined-players h4 {
            margin-top: 0;
            color: #333;
            font-size: 1.1em;
        }
        
        .player-joined {
            background: #28a745;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px 0;
            display: inline-block;
            font-size: 0.9em;
        }

        .team-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .team-card {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            text-align: left;
        }

        .team-card h4 {
            color: #333;
            margin: 0 0 10px 0;
            text-align: center;
            font-size: 1.1em;
        }

        .team-positions {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .position-summary {
            font-size: 0.9em;
            color: #555;
        }

        .position-summary strong {
            color: #333;
            min-width: 40px;
            display: inline-block;
        }

        .game-area {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: flex-start;
        }
        
        .wheel-section-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .team-builder-bottom {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .team-builder-bottom h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
        }
        
        .wheel-section {
            flex: 1;
            max-width: 500px;
        }
        
        .wheel-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 20px auto;
        }
        
        #wheel, #wheel-dream {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 12px solid #2c3e50;
            transition: transform 3s cubic-bezier(0.23, 1, 0.32, 1);
            background: #f0f0f0;
            box-shadow: 0 0 30px rgba(0,0,0,0.3), inset 0 0 20px rgba(0,0,0,0.1);
        }
        
        .wheel-segment {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
            z-index: 1;
            border: 1px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .wheel-segment img {
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.7));
        }

        .wheel-section {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50%;
            height: 2px;
            transform-origin: 0 0;
            pointer-events: none;
        }

        .wheel-section::before {
            content: '';
            position: absolute;
            left: 0;
            top: -1px;
            width: 100%;
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.3) 30%, rgba(255,255,255,0.8) 70%, transparent);
            transform-origin: 0 0;
        }

        .wheel-section::after {
            content: var(--team-name);
            position: absolute;
            left: 120px;
            top: -8px;
            width: 60px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            text-align: center;
            line-height: 1;
            transform: rotate(6deg);
            pointer-events: none;
        }

        .wheel-section:nth-child(1) { transform: rotate(6deg); --team-name: "ATL"; }
        .wheel-section:nth-child(2) { transform: rotate(18deg); --team-name: "BOS"; }
        .wheel-section:nth-child(3) { transform: rotate(30deg); --team-name: "BKN"; }
        .wheel-section:nth-child(4) { transform: rotate(42deg); --team-name: "CHA"; }
        .wheel-section:nth-child(5) { transform: rotate(54deg); --team-name: "CHI"; }
        .wheel-section:nth-child(6) { transform: rotate(66deg); --team-name: "CLE"; }
        .wheel-section:nth-child(7) { transform: rotate(78deg); --team-name: "DAL"; }
        .wheel-section:nth-child(8) { transform: rotate(90deg); --team-name: "DEN"; }
        .wheel-section:nth-child(9) { transform: rotate(102deg); --team-name: "DET"; }
        .wheel-section:nth-child(10) { transform: rotate(114deg); --team-name: "GSW"; }
        .wheel-section:nth-child(11) { transform: rotate(126deg); --team-name: "HOU"; }
        .wheel-section:nth-child(12) { transform: rotate(138deg); --team-name: "IND"; }
        .wheel-section:nth-child(13) { transform: rotate(150deg); --team-name: "LAC"; }
        .wheel-section:nth-child(14) { transform: rotate(162deg); --team-name: "LAL"; }
        .wheel-section:nth-child(15) { transform: rotate(174deg); --team-name: "MEM"; }
        .wheel-section:nth-child(16) { transform: rotate(186deg); --team-name: "MIA"; }
        .wheel-section:nth-child(17) { transform: rotate(198deg); --team-name: "MIL"; }
        .wheel-section:nth-child(18) { transform: rotate(210deg); --team-name: "MIN"; }
        .wheel-section:nth-child(19) { transform: rotate(222deg); --team-name: "NOP"; }
        .wheel-section:nth-child(20) { transform: rotate(234deg); --team-name: "NYK"; }
        .wheel-section:nth-child(21) { transform: rotate(246deg); --team-name: "OKC"; }
        .wheel-section:nth-child(22) { transform: rotate(258deg); --team-name: "ORL"; }
        .wheel-section:nth-child(23) { transform: rotate(270deg); --team-name: "PHI"; }
        .wheel-section:nth-child(24) { transform: rotate(282deg); --team-name: "PHX"; }
        .wheel-section:nth-child(25) { transform: rotate(294deg); --team-name: "POR"; }
        .wheel-section:nth-child(26) { transform: rotate(306deg); --team-name: "SAC"; }
        .wheel-section:nth-child(27) { transform: rotate(318deg); --team-name: "SAS"; }
        .wheel-section:nth-child(28) { transform: rotate(330deg); --team-name: "TOR"; }
        .wheel-section:nth-child(29) { transform: rotate(342deg); --team-name: "UTA"; }
        .wheel-section:nth-child(30) { transform: rotate(354deg); --team-name: "WAS"; }
        
        .pointer {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #e74c3c;
            z-index: 10;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }

        .pointer::after {
            content: '';
            position: absolute;
            top: -38px;
            left: -15px;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid #c0392b;
            z-index: 11;
        }
        
        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 50%;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5), inset 0 0 10px rgba(255,255,255,0.1);
            border: 4px solid #ecf0f1;
        }
        
        .spin-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .spin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .spin-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .team-builder {
            flex: 1;
            max-width: 600px;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .team-builder h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .spin-counter {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
            display: inline-block;
        }

        .positions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .position-slot {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            text-align: left;
        }

        .position-slot.filled {
            border-color: #4CAF50;
            background: #f0f8f0;
        }

        .position-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .position-player {
            color: #666;
            font-size: 0.9em;
            min-height: 40px;
        }

        .position-player.filled {
            color: #2c3e50;
            font-weight: bold;
        }

        .player-selection {
            display: none;
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #ffc107;
        }

        .player-selection.show {
            display: block;
        }

        .player-dropdown {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            margin: 10px 0;
        }

        .position-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .position-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .position-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .position-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .battle-section {
            margin-top: 30px;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            border: 2px solid #ffc107;
        }

        .battle-button {
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.3em;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .battle-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .battle-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .battle-button.secondary {
            background: linear-gradient(45deg, #757575, #616161);
        }

        .battle-results {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        .battle-summary {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            color: white;
        }

        .team-comparison {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
        }

        .team-result {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            flex: 1;
            margin: 0 10px;
        }

        .team-score {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
            margin: 10px 0;
        }

        .team-breakdown {
            text-align: left;
            font-size: 0.9em;
            color: #666;
        }

        .vs-divider {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
            margin: 0 20px;
        }

        .position-battles {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .position-battle {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .position {
            font-weight: bold;
            min-width: 40px;
        }

        .battle-result {
            flex: 1;
            margin: 0 10px;
            font-size: 0.9em;
        }

        .battle-winner {
            font-weight: bold;
            color: #4CAF50;
        }

        .battle-analysis {
            margin: 30px 0;
            padding: 20px;
            background: #e8f5e8;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }

        .battle-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .popup-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .popup h2 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .close-popup {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 20px;
        }

        .classic-mode {
            display: block;
        }

        .dream-team-mode {
            display: none;
        }

        .dream-team-mode.active {
            display: block;
        }

        .classic-mode.active {
            display: block;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
                align-items: center;
            }
            
            .wheel-container {
                width: 300px;
                height: 300px;
            }
            
            .positions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
                  <h1>üèÄ George and Frankie's Dream Team Builder Game üèÄ</h1>
                  
                  <!-- Sound Toggle Button -->
                  <div style="position: absolute; top: 20px; right: 20px;">
                      <button id="soundToggle" onclick="SoundManager.toggle()" style="
                          background: #4CAF50;
                          color: white;
                          border: none;
                          padding: 10px 15px;
                          border-radius: 20px;
                          cursor: pointer;
                          font-size: 14px;
                          transition: all 0.3s ease;
                          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                      ">üîä Sound ON</button>
                  </div>
        
        <!-- Game Setup Phase -->
        <div id="setup-phase" class="setup-section">
            <h2>üéÆ Game Setup</h2>
            <div class="setup-step" id="player-count-step">
              <h3>How many players want to play?</h3>
              <div class="player-count-buttons">
                <button class="count-button" onclick="selectPlayerCount(2)">2 Players</button>
                <button class="count-button" onclick="selectPlayerCount(3)">3 Players</button>
                <button class="count-button" onclick="selectPlayerCount(4)">4 Players</button>
              </div>
            </div>
            
            <div class="setup-step" id="game-type-step" style="display: none;">
              <h3>How do you want to play?</h3>
              <div class="game-type-buttons">
                <button class="type-button" onclick="selectGameType('local')">
                  üì± <strong>Play on This Device</strong><br>
                  <small>Pass the device around to take turns</small>
                </button>
                <button class="type-button" onclick="selectGameType('online')">
                  üåê <strong>Invite Friends Online</strong><br>
                  <small>Share a link for friends to join remotely</small>
                </button>
              </div>
            </div>
            
            <div class="setup-step" id="invite-step" style="display: none;">
              <h3>üéâ Invite Your Friends!</h3>
              <p>Share this link with your friends so they can join the game:</p>
              <div class="invite-link-container">
                <input type="text" id="inviteLink" readonly class="invite-link-input">
                <button class="copy-button" onclick="copyInviteLink()">üìã Copy Link</button>
              </div>
              <p class="invite-instructions">
                <strong>Instructions:</strong><br>
                1. Click "Copy Link" above<br>
                2. Send the link to your friends via text, email, or social media<br>
                3. Wait for them to join using the link<br>
                4. Once everyone joins, you can start the game!
              </p>
              <div class="joined-players">
                <h4>Players Joined:</h4>
                <div id="joinedPlayersList">
                  <div class="player-joined">üéÆ You (Host)</div>
                </div>
              </div>
              <button class="start-button" id="startOnlineGame" onclick="startOnlineGame()" disabled>
                üöÄ Start Game! (Waiting for players...)
              </button>
            </div>
            
            <div class="setup-step" id="player-names-step" style="display: none;">
              <h3>Enter Player Names</h3>
              <div id="player-name-inputs"></div>
              <button class="start-button" onclick="startMultiplayerGame()">üöÄ Start Game!</button>
            </div>
        </div>
        
        <!-- Game Mode Selection -->
        <div class="game-modes" id="mode-selection" style="display: none;">
            <button class="mode-button active" onclick="switchMode('classic')">üéØ Classic Spin</button>
            <button class="mode-button" onclick="switchMode('multiplayer')">üèÜ Multiplayer Dream Team Builder</button>
        </div>

        <!-- Classic Mode -->
        <div id="classic-mode" class="classic-mode">
        <div class="wheel-container">
            <div class="pointer"></div>
            <div id="wheel">
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                    <div class="wheel-section"></div>
                <div class="center-circle">NBA</div>
            </div>
        </div>
        
            <div class="result" id="classic-result">Click "Spin the Wheel" to start!</div>
        
            <button class="spin-button" id="classicSpinButton" onclick="spinWheel()">
            üéØ SPIN THE WHEEL! üéØ
        </button>
        </div>

        <!-- Dream Team Builder Mode -->
        <div id="dream-team-mode" class="dream-team-mode">
            <!-- Wheel Section - Centered at Top -->
            <div class="wheel-section-container">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <div id="wheel-dream">
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="wheel-section"></div>
                        <div class="center-circle">NBA</div>
                    </div>
                </div>
                
                <div class="result" id="dream-result">Ready to build your dream team!</div>
                
                <button class="spin-button" id="dreamSpinButton" onclick="spinForDreamTeam()">
                    üéØ SPIN FOR PLAYER! üéØ
                </button>

                <!-- Player Selection Interface -->
                <div class="player-selection" id="playerSelection">
                    <h3>üèÄ Select Your Player!</h3>
                    <p>You landed on: <span id="selectedTeamName"></span></p>
                    <select class="player-dropdown" id="playerDropdown">
                        <option value="">Loading players...</option>
                    </select>
                    <p><strong>Choose a position for this player:</strong></p>
                    <div class="position-buttons" id="positionButtons">
                        <button class="position-btn" onclick="assignPlayer('pg')">Point Guard</button>
                        <button class="position-btn" onclick="assignPlayer('sg')">Shooting Guard</button>
                        <button class="position-btn" onclick="assignPlayer('sf')">Small Forward</button>
                        <button class="position-btn" onclick="assignPlayer('pf')">Power Forward</button>
                        <button class="position-btn" onclick="assignPlayer('c')">Center</button>
                        <button class="position-btn" onclick="assignPlayer('sixth')">6th Man</button>
                        <button class="position-btn" onclick="assignPlayer('seventh')">7th Man</button>
                        <button class="position-btn" onclick="assignPlayer('coach')">Coach</button>
                    </div>
                </div>
            </div>

            <!-- Team Builder Section - Below Wheel -->
            <div class="team-builder-bottom">
                <h2>üèÜ Your Dream Team</h2>
                <div class="spin-counter" id="spinCounter">Spins Left: 8</div>
                
                <div class="positions-grid">
                    <div class="position-slot" id="slot-pg">
                        <div class="position-title">üéØ Point Guard</div>
                        <div class="position-player">Empty</div>
                    </div>
                    <div class="position-slot" id="slot-sg">
                        <div class="position-title">üéØ Shooting Guard</div>
                        <div class="position-player">Empty</div>
                    </div>
                    <div class="position-slot" id="slot-sf">
                        <div class="position-title">üéØ Small Forward</div>
                        <div class="position-player">Empty</div>
                    </div>
                    <div class="position-slot" id="slot-pf">
                        <div class="position-title">üéØ Power Forward</div>
                        <div class="position-player">Empty</div>
                    </div>
                    <div class="position-slot" id="slot-c">
                        <div class="position-title">üéØ Center</div>
                        <div class="position-player">Empty</div>
                    </div>
                    <div class="position-slot" id="slot-sixth">
                        <div class="position-title">üéØ 6th Man</div>
                        <div class="position-player">Empty</div>
                    </div>
                    <div class="position-slot" id="slot-seventh">
                        <div class="position-title">üéØ 7th Man</div>
                        <div class="position-player">Empty</div>
                    </div>
                    <div class="position-slot" id="slot-coach">
                        <div class="position-title">üéØ Coach</div>
                        <div class="position-player">Empty</div>
                    </div>
                </div>

                <div class="battle-section" id="battleSection" style="display: none;">
                    <h3>üî• Ready for Battle!</h3>
                    <p>Your dream team is complete! Ready to face the competition?</p>
                    <button class="battle-button" onclick="startBattle()">‚öîÔ∏è START BATTLE! ‚öîÔ∏è</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="popup" id="popup">
        <div class="popup-content">
            <h2>üéâ Result! üéâ</h2>
            <p id="popupResult"></p>
            <button class="close-popup" onclick="closePopup()">Awesome!</button>
        </div>
    </div>

    <!-- NBA Data is now loaded from JSON file -->
    <script>
        // Game State
        let gameState = {
            phase: 'setup', // setup, classic, multiplayer, battle
            mode: 'classic',
            numPlayers: 2,
            players: [],
            currentPlayerIndex: 0,
            currentRound: 1,
            maxRounds: 8,
            dreamTeams: [], // Array to store each player's team
            currentTeam: null,
            currentPlayers: [],
            isSpinning: false
        };

        // NBA Teams Data - Will be loaded from JSON file
        let nbaTeams = [];
        
        // Multiplayer Setup Functions
        function selectPlayerCount(count) {
            gameState.numPlayers = count;
            
            // Update button states
            document.querySelectorAll('.count-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Show game type selection
            setTimeout(() => {
                document.getElementById('player-count-step').style.display = 'none';
                document.getElementById('game-type-step').style.display = 'block';
            }, 500);
        }
        
        function selectGameType(type) {
            gameState.gameType = type;
            
            if (type === 'local') {
                // Show player name inputs for local play
                setTimeout(() => {
                    document.getElementById('game-type-step').style.display = 'none';
                    document.getElementById('player-names-step').style.display = 'block';
                    createPlayerNameInputs(gameState.numPlayers);
                }, 500);
            } else if (type === 'online') {
                // Show invite step for online play
                setTimeout(() => {
                    document.getElementById('game-type-step').style.display = 'none';
                    document.getElementById('invite-step').style.display = 'block';
                    generateInviteLink();
                }, 500);
            }
        }
        
        function generateInviteLink() {
            // Generate a unique game room ID
            const roomId = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            const gameUrl = `${window.location.origin}${window.location.pathname}?room=${roomId}&players=${gameState.numPlayers}`;
            
            // Update the invite link input
            document.getElementById('inviteLink').value = gameUrl;
            
            // Store the room ID for later use
            gameState.roomId = roomId;
            
            console.log('üéÆ Generated game room:', roomId);
        }
        
        function copyInviteLink() {
            const inviteLink = document.getElementById('inviteLink');
            inviteLink.select();
            inviteLink.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                
                // Update button text temporarily
                const copyButton = document.querySelector('.copy-button');
                const originalText = copyButton.textContent;
                copyButton.textContent = '‚úÖ Copied!';
                copyButton.style.background = '#28a745';
                
                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.style.background = '#28a745';
                }, 2000);
                
                console.log('üìã Invite link copied to clipboard');
            } catch (err) {
                console.error('‚ùå Failed to copy invite link:', err);
                alert('Unable to copy automatically. Please copy the link manually.');
            }
        }
        
        function startOnlineGame() {
            // For now, simulate starting the game
            // In a real implementation, this would check if all players have joined
            const playerNames = [`Player 1 (Host)`];
            for (let i = 1; i < gameState.numPlayers; i++) {
                playerNames.push(`Player ${i + 1}`);
            }
            
            // Initialize game state
            gameState.players = playerNames.map(name => ({ name, teamComplete: false }));
            gameState.dreamTeams = playerNames.map(() => ({
                pg: null, sg: null, sf: null, pf: null, c: null,
                sixth: null, seventh: null, coach: null
            }));
            gameState.currentPlayerIndex = 0;
            gameState.currentRound = 1;
            gameState.phase = 'multiplayer';
            
            // Hide setup and show game
            document.getElementById('setup-phase').style.display = 'none';
            document.getElementById('mode-selection').style.display = 'block';
            
            // Auto-select multiplayer mode
            switchMode('multiplayer');
            
            console.log('üéÆ Online multiplayer game started with players:', playerNames);
        }
        
        // Check if player is joining an existing game
        function checkForInviteLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');
            const playerCount = urlParams.get('players');
            
            if (roomId && playerCount) {
                console.log('üéÆ Joining game room:', roomId);
                
                // Show joining message
                document.getElementById('setup-phase').innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <h2>üéÆ Joining Game...</h2>
                        <p>Room ID: ${roomId}</p>
                        <p>Players: ${playerCount}</p>
                        <p>Please wait while we connect you to the game...</p>
                        <div style="margin-top: 30px;">
                            <button class="start-button" onclick="location.href='${window.location.origin}${window.location.pathname}'">
                                üè† Create New Game Instead
                            </button>
                        </div>
                    </div>
                `;
                
                // In a real implementation, this would connect to the game server
                // For now, just show a message
                setTimeout(() => {
                    alert('üéÆ Multiplayer functionality will be fully implemented soon! For now, create a new game.');
                }, 2000);
            }
        }
        
        function createPlayerNameInputs(count) {
            const container = document.getElementById('player-name-inputs');
            container.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'name-input';
                input.placeholder = `Enter Player ${i + 1} Name`;
                input.id = `player-name-${i}`;
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const nextInput = document.getElementById(`player-name-${i + 1}`);
                        if (nextInput) {
                            nextInput.focus();
                        } else {
                            startMultiplayerGame();
                        }
                    }
                });
                container.appendChild(input);
            }
            
            // Focus on first input
            document.getElementById('player-name-0').focus();
        }
        
        function startMultiplayerGame() {
            // Collect player names
            const names = [];
            for (let i = 0; i < gameState.numPlayers; i++) {
                const name = document.getElementById(`player-name-${i}`).value.trim();
                if (name === '') {
                    alert(`Please enter a name for Player ${i + 1}`);
                    document.getElementById(`player-name-${i}`).focus();
                    return;
                }
                names.push(name);
            }
            
            // Initialize game state
            gameState.players = names.map(name => ({ name, teamComplete: false }));
            gameState.dreamTeams = names.map(() => ({
                pg: null, sg: null, sf: null, pf: null, c: null,
                sixth: null, seventh: null, coach: null
            }));
            gameState.currentPlayerIndex = 0;
            gameState.currentRound = 1;
            gameState.phase = 'multiplayer';
            
            // Hide setup and show game
            document.getElementById('setup-phase').style.display = 'none';
            document.getElementById('mode-selection').style.display = 'block';
            
            // Auto-select multiplayer mode
            switchMode('multiplayer');
            
            console.log('üéÆ Multiplayer game started with players:', names);
        }
        
        // Load NBA teams data from our comprehensive database
        async function loadNBATeams() {
            try {
                console.log("üèÄ Loading NBA teams from comprehensive database...");
                
                // Load team information from our organized database
                const teamResponse = await fetch('database/nba/teams/team-info.json');
                const teamData = await teamResponse.json();
                
                // Load player rosters from our database
                const rosterResponse = await fetch('database/nba/players/rosters.json');
                const rosterData = await rosterResponse.json();
                
                // Combine team info with rosters
                nbaTeams = teamData.teams.map(team => {
                    const teamRoster = rosterData.teams.find(t => t.id === team.id);
                    return {
                        id: team.id,
                        name: team.name,
                        abbreviation: team.abbreviation,
                        color_primary: team.color_primary,
                        color_secondary: team.color_secondary,
                        logo_file: team.logo_file,
                        city: team.city,
                        state: team.state,
                        conference: team.conference,
                        division: team.division,
                        roster: teamRoster ? teamRoster.roster : []
                    };
                });
                
                console.log(`‚úÖ Successfully loaded ${nbaTeams.length} NBA teams from database`);
                console.log(`üìä Total players across all teams: ${nbaTeams.reduce((sum, team) => sum + team.roster.length, 0)}`);
                
                // Draw the wheel with logos
                drawWheelWithLogos();
                
                return nbaTeams;
            } catch (error) {
                console.error('‚ùå Error loading NBA teams from database:', error);
                // Load from the old JSON file as fallback
                return loadNBATeamsFromOldJSON();
            }
        }
        
        // Fallback function to load from old JSON structure if database fails
        async function loadNBATeamsFromOldJSON() {
            try {
                console.log("üîÑ Falling back to old JSON structure...");
                const response = await fetch('data/nba_teams_data.json');
                const data = await response.json();
                
                nbaTeams = data.teams.map(team => ({
                    id: team.id,
                    name: team.name,
                    abbreviation: team.abbreviation,
                    color_primary: team.color_primary,
                    color_secondary: team.color_secondary,
                    logo_file: team.logo_file,
                    city: team.city,
                    state: team.state,
                    conference: team.conference,
                    division: team.division,
                    roster: team.roster
                }));
                
                console.log(`‚úÖ Fallback successful: loaded ${nbaTeams.length} NBA teams`);
                drawWheelWithLogos();
                return nbaTeams;
            } catch (fallbackError) {
                console.error('‚ùå Fallback also failed:', fallbackError);
                // Create minimal team data
                nbaTeams = [
                    {name: "Atlanta Hawks", color_primary: "#E03A3E", abbreviation: "ATL"},
                    {name: "Boston Celtics", color_primary: "#007A33", abbreviation: "BOS"},
                    {name: "Brooklyn Nets", color_primary: "#000000", abbreviation: "BKN"},
                    {name: "Charlotte Hornets", color_primary: "#1D1160", abbreviation: "CHA"},
                    {name: "Chicago Bulls", color_primary: "#CE1141", abbreviation: "CHI"}
                ];
                console.log("‚ö†Ô∏è Using minimal team data");
                return nbaTeams;
            }
        }

        // Test function to check if data is loaded (call from console)
        function testDataLoading() {
            console.log("üîç Testing data loading...");
            console.log("üìä Teams loaded:", nbaTeams.length);
            console.log("üèÜ First team:", nbaTeams[0]);
            console.log("üë• First team roster:", nbaTeams[0]?.roster?.length || 0, "players");
            console.log("üéØ Sample player:", nbaTeams[0]?.roster?.[0]);
            
            // Test loading a specific team
            if (nbaTeams.length > 0) {
                loadPlayersForTeam(nbaTeams[0])
                    .then(players => {
                        console.log("‚úÖ Test successful! Loaded", players.length, "players");
                        console.log("üèÜ First player:", players[0]);
                        
                        // Display results on the page
                        alert(`Test Results:\n\n‚úÖ Teams loaded: ${nbaTeams.length}\nüèÜ First team: ${nbaTeams[0]?.name}\nüë• Players: ${players.length}\nüéØ First player: ${players[0]?.full_name || players[0]?.first_name + ' ' + players[0]?.last_name}`);
                    })
                    .catch(error => {
                        console.error("‚ùå Test failed:", error);
                        alert("‚ùå Test failed - check console for details");
                    });
            } else {
                alert("‚ùå No teams loaded!");
            }
        }

        // Direct test of JSON loading
        async function testDirectJSONLoad() {
            try {
                console.log("üîç Testing direct JSON load...");
                const response = await fetch('data/nba_teams_data.json');
                const data = await response.json();
                console.log("‚úÖ JSON loaded successfully");
                console.log("üìä Teams in JSON:", data.teams.length);
                console.log("üèÜ First team in JSON:", data.teams[0].name);
                console.log("üë• First team roster:", data.teams[0].roster.length);
                console.log("üéØ First player:", data.teams[0].roster[0]);
                
                alert(`Direct JSON Test:\n\n‚úÖ Teams in file: ${data.teams.length}\nüèÜ First team: ${data.teams[0].name}\nüë• Players: ${data.teams[0].roster.length}\nüéØ First player: ${data.teams[0].roster[0].name}`);
            } catch (error) {
                console.error("‚ùå Direct JSON test failed:", error);
                alert("‚ùå Direct JSON test failed - check console");
            }
        }
        
        // Test NBA 2K25 database loading
        async function testNBA2K25Database() {
            try {
                console.log("üîç Testing NBA 2K25 database load...");
                
                // Test the NEW correct path
                const response = await fetch('database/nba/players/nba-2k25-master-ratings.json');
                console.log("üìä Response status:", response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log("‚úÖ NBA 2K25 database loaded successfully");
                    console.log("üìä Number of teams:", Object.keys(data.teams).length);
                    console.log("üèÜ First team:", Object.keys(data.teams)[0]);
                    console.log("üë• First team players:", data.teams[Object.keys(data.teams)[0]].players.length);
                    console.log("üéØ First player:", data.teams[Object.keys(data.teams)[0]].players[0]);
                    
                    alert(`NBA 2K25 Database Test:\n\n‚úÖ Status: ${response.status}\nüìä Teams: ${Object.keys(data.teams).length}\nüèÜ First team: ${Object.keys(data.teams)[0]}\nüë• Players: ${data.teams[Object.keys(data.teams)[0]].players.length}\nüéØ First player: ${data.teams[Object.keys(data.teams)[0]].players[0].name}`);
                } else {
                    console.error("‚ùå NBA 2K25 database failed to load:", response.status);
                    alert(`‚ùå NBA 2K25 database failed to load!\n\nStatus: ${response.status}\nThe file path might be incorrect or the file doesn't exist.`);
                }
            } catch (error) {
                console.error("‚ùå NBA 2K25 database test failed:", error);
                alert(`‚ùå NBA 2K25 database test failed!\n\nError: ${error.message}`);
            }
        }

        // Force test a specific team (Atlanta Hawks)
        function testAtlantaHawks() {
            console.log("üîç Testing Atlanta Hawks specifically...");
            
            // Create a mock team object to test
            const atlantaTeam = {
                name: "Atlanta Hawks",
                color: "#E03A3E",
                abbreviation: "ATL"
            };
            
            console.log("üèÄ Testing team:", atlantaTeam);
            showPlayerSelection(atlantaTeam);
        }

        // Initialize the game
        window.onload = function() {
            console.log("üèÄ George and Frankie's Dream Team Builder Game Loading...");
            
            // Initialize sound system
            SoundManager.init();
            
            // Clear any old cached data that might be causing issues
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    cacheNames.forEach(cacheName => {
                        if (cacheName.includes('nba-team-wheel-v1.0')) {
                            caches.delete(cacheName);
                            console.log('üóëÔ∏è Cleared old cache:', cacheName);
                        }
                    });
                });
            }
            
            // Check if player is joining via invite link
            checkForInviteLink();
            
            // Load NBA teams data
            loadNBATeams()
                .then(() => {
                    console.log("‚úÖ George and Frankie's Dream Team Builder Game Ready!");
                    console.log("üìä Total teams loaded:", nbaTeams.length);
                    console.log("üèÜ First team has", nbaTeams[0]?.roster?.length || 0, "roster members");
                    console.log("üéØ Type 'testDataLoading()' in console to test data loading");
                })
                .catch(error => {
                    console.error("‚ùå Error initializing George and Frankie's Dream Team Builder Game:", error);
                });
            
            // Initialize NBA data framework
            if (typeof NBAData !== 'undefined') {
                NBAData.initialize()
                    .then(() => {
                        console.log("‚úÖ NBA Data Framework Ready!");
                    })
                    .catch(error => {
                        console.warn("‚ö†Ô∏è NBA Data Framework not available, using mock data");
                        // Game will still work with mock data
                    });
            } else {
                console.warn("‚ö†Ô∏è NBA Data Framework not loaded, using mock data");
            }
        };

        // Draw wheel with team logos
        function drawWheelWithLogos() {
            if (nbaTeams.length === 0) {
                console.log("‚ö†Ô∏è No teams loaded yet, skipping wheel drawing");
                return;
            }
            
            console.log("üé® Drawing wheel with logos for", nbaTeams.length, "teams");
            
            // Update both wheels (classic and dream team)
            updateWheelSegments('wheel');
            updateWheelSegments('wheel-dream');
        }
        
        // Update wheel segments with team data
        function updateWheelSegments(wheelId) {
            const wheel = document.getElementById(wheelId);
            if (!wheel) return;
            
            console.log("üé® Updating wheel segments for", wheelId, "with", nbaTeams.length, "teams");
            
            // Clear existing segments but keep wheel-sections for CSS compatibility
            const existingSections = wheel.querySelectorAll('.wheel-section');
            existingSections.forEach(section => section.remove());
            
            const totalTeams = nbaTeams.length;
            const anglePerSegment = 360 / totalTeams;
            
            // Create segments using the existing wheel-section structure
            for (let i = 0; i < totalTeams; i++) {
                const team = nbaTeams[i];
                const rotation = (i * anglePerSegment);
                
                // Create section element
                const section = document.createElement('div');
                section.className = 'wheel-section';
                section.style.transform = `rotate(${rotation}deg)`;
                section.style.setProperty('--team-name', `"${team.abbreviation}"`);
                
                // Add logo if available
                if (team.logo_file) {
                    const logo = document.createElement('img');
                    logo.src = team.logo_file;
                    logo.style.position = 'absolute';
                    logo.style.left = '110px';
                    logo.style.top = '-15px';
                    logo.style.width = '24px';
                    logo.style.height = '24px';
                    logo.style.objectFit = 'contain';
                    logo.style.filter = 'drop-shadow(1px 1px 2px rgba(0,0,0,0.8))';
                    logo.style.transform = 'rotate(6deg)';
                    logo.alt = team.abbreviation;
                    section.appendChild(logo);
                }
                
                wheel.appendChild(section);
            }
            
            // Update the background to show team colors
            const colorStops = [];
            for (let i = 0; i < totalTeams; i++) {
                const team = nbaTeams[i];
                const startAngle = i * anglePerSegment;
                const endAngle = (i + 1) * anglePerSegment;
                // Use color_primary from the data structure
                colorStops.push(`${team.color_primary} ${startAngle}deg ${endAngle}deg`);
            }
            
            wheel.style.background = `conic-gradient(from 0deg, ${colorStops.join(', ')})`;
            console.log("‚úÖ Wheel background updated with team colors");
        }

        // Switch between game modes
        function switchMode(mode) {
            gameState.mode = mode;
            
            // Update button states
            document.querySelectorAll('.mode-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (mode === 'classic') {
                document.getElementById('classic-mode').style.display = 'block';
                document.getElementById('dream-team-mode').style.display = 'none';
                document.querySelector('.mode-button').classList.add('active');
            } else if (mode === 'multiplayer') {
                document.getElementById('classic-mode').style.display = 'none';
                document.getElementById('dream-team-mode').style.display = 'block';
                document.querySelectorAll('.mode-button')[1].classList.add('active');
                initializeMultiplayerMode();
            }
        }
        
        // Initialize multiplayer mode
        function initializeMultiplayerMode() {
            updateMultiplayerDisplay();
            resetCurrentTeam();
        }
        
        // Update multiplayer display
        function updateMultiplayerDisplay() {
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const spinCounter = document.getElementById('spinCounter');
            const dreamResult = document.getElementById('dream-result');
            
            spinCounter.textContent = `${currentPlayer.name}'s Turn - Round ${gameState.currentRound}/8`;
            dreamResult.textContent = `${currentPlayer.name}, spin the wheel to get your next player!`;
            
            // Show current player's team
            displayCurrentPlayerTeam();
        }
        
        // Display current player's team
        function displayCurrentPlayerTeam() {
            const currentTeam = gameState.dreamTeams[gameState.currentPlayerIndex];
            const positions = ['pg', 'sg', 'sf', 'pf', 'c', 'sixth', 'seventh', 'coach'];
            
            positions.forEach(pos => {
                const slot = document.getElementById(`slot-${pos}`);
                const playerDiv = slot.querySelector('.position-player');
                
                if (currentTeam[pos]) {
                    playerDiv.textContent = currentTeam[pos].full_name || `${currentTeam[pos].first_name} ${currentTeam[pos].last_name}`;
                    playerDiv.classList.add('filled');
                    slot.classList.add('filled');
                } else {
                    playerDiv.textContent = 'Empty';
                    playerDiv.classList.remove('filled');
                    slot.classList.remove('filled');
                }
            });
        }
        
        // Reset current team display
        function resetCurrentTeam() {
            document.querySelectorAll('.position-slot').forEach(slot => {
                slot.classList.remove('filled');
                const playerDiv = slot.querySelector('.position-player');
                playerDiv.textContent = 'Empty';
                playerDiv.classList.remove('filled');
            });
        }

        // Visual Effects System
        const VisualEffects = {
            createConfetti(container = document.body) {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd'];
                const confettiCount = 50;
                
                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed;
                        width: 10px;
                        height: 10px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        top: -10px;
                        left: ${Math.random() * 100}vw;
                        z-index: 10000;
                        pointer-events: none;
                        transform: rotate(${Math.random() * 360}deg);
                        animation: confetti-fall 3s linear forwards;
                    `;
                    
                    container.appendChild(confetti);
                    
                    // Remove confetti after animation
                    setTimeout(() => {
                        if (confetti.parentNode) {
                            confetti.parentNode.removeChild(confetti);
                        }
                    }, 3000);
                }
            },
            
            createFloatingText(text, container, color = '#ff6b6b') {
                const floatingText = document.createElement('div');
                floatingText.textContent = text;
                floatingText.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    color: ${color};
                    font-size: 2em;
                    font-weight: bold;
                    z-index: 9999;
                    pointer-events: none;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                    animation: float-up 2s ease-out forwards;
                `;
                
                container.appendChild(floatingText);
                
                // Remove text after animation
                setTimeout(() => {
                    if (floatingText.parentNode) {
                        floatingText.parentNode.removeChild(floatingText);
                    }
                }, 2000);
            },
            
            addSpinGlow(wheelElement) {
                wheelElement.style.boxShadow = '0 0 30px rgba(255, 107, 107, 0.8), 0 0 60px rgba(255, 107, 107, 0.4)';
                wheelElement.style.transform = wheelElement.style.transform + ' scale(1.02)';
            },
            
            removeSpinGlow(wheelElement) {
                wheelElement.style.boxShadow = '';
                wheelElement.style.transform = wheelElement.style.transform.replace(' scale(1.02)', '');
            }
        };

        // Add CSS animations for visual effects
        const style = document.createElement('style');
        style.textContent = `
            @keyframes confetti-fall {
                0% {
                    transform: translateY(-100vh) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
            
            @keyframes float-up {
                0% {
                    transform: translate(-50%, -50%) scale(0.5);
                    opacity: 0;
                }
                50% {
                    transform: translate(-50%, -50%) scale(1.2);
                    opacity: 1;
                }
                100% {
                    transform: translate(-50%, -100px) scale(1);
                    opacity: 0;
                }
            }
            
            .wheel-container {
                position: relative;
                transition: all 0.3s ease;
            }
            
            .spinning-glow {
                box-shadow: 0 0 30px rgba(255, 107, 107, 0.8), 0 0 60px rgba(255, 107, 107, 0.4);
                transform: scale(1.02);
            }
            
            .position-slot.filled {
                animation: slot-fill 0.5s ease-out;
            }
            
            @keyframes slot-fill {
                0% {
                    transform: scale(0.8);
                    background: #e8f5e8;
                }
                50% {
                    transform: scale(1.1);
                    background: #c8e6c9;
                }
                100% {
                    transform: scale(1);
                    background: #f0f8f0;
                }
            }
            
            .spin-button {
                position: relative;
                overflow: hidden;
                transition: all 0.3s ease;
            }
            
            .spin-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            }
            
            .spin-button:active {
                transform: translateY(0);
            }
            
            .celebration-popup {
                animation: celebration-bounce 0.6s ease-out;
            }
            
            @keyframes celebration-bounce {
                0% {
                    transform: scale(0.5);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.2);
                    opacity: 1;
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        // Sound System for the Game
        const SoundManager = {
            audioContext: null,
            soundsEnabled: true,
            
            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    console.log('üéµ Sound system initialized');
                } catch (error) {
                    console.warn('üîá Sound system not available:', error);
                    this.soundsEnabled = false;
                }
            },
            
            playSpinSound() {
                if (!this.soundsEnabled || !this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                // Create a sweeping sound for spinning
                oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, this.audioContext.currentTime + 0.1);
                oscillator.frequency.exponentialRampToValueAtTime(150, this.audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + 0.3);
            },
            
            playCelebrationSound() {
                if (!this.soundsEnabled || !this.audioContext) return;
                
                // Create a celebratory sound with multiple tones
                const frequencies = [523, 659, 784, 1047]; // C, E, G, C (major chord)
                
                frequencies.forEach((freq, index) => {
                    setTimeout(() => {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(freq, this.audioContext.currentTime);
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                        
                        oscillator.start();
                        oscillator.stop(this.audioContext.currentTime + 0.5);
                    }, index * 100);
                });
            },
            
            playSuccessSound() {
                if (!this.soundsEnabled || !this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.2);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + 0.3);
            },
            
            toggle() {
                this.soundsEnabled = !this.soundsEnabled;
                const soundButton = document.getElementById('soundToggle');
                if (soundButton) {
                    soundButton.textContent = this.soundsEnabled ? 'üîä Sound ON' : 'üîá Sound OFF';
                    soundButton.style.background = this.soundsEnabled ? '#4CAF50' : '#666';
                }
                console.log('üéµ Sound', this.soundsEnabled ? 'enabled' : 'disabled');
            }
        };

        // Classic wheel spin
        function spinWheel() {
            if (gameState.isSpinning) return;
            
            gameState.isSpinning = true;
            const spinButton = document.getElementById('classicSpinButton');
            const result = document.getElementById('classic-result');
            const wheel = document.getElementById('wheel');
            
            spinButton.disabled = true;
            spinButton.textContent = 'Spinning...';
            result.textContent = 'üéØ Spinning the wheel... üéØ';
            
            // Play spinning sound
            SoundManager.playSpinSound();
            
            // Add spinning glow effect
            wheel.parentElement.classList.add('spinning-glow');
            
            const spins = Math.floor(Math.random() * 5) + 5;
            const finalAngle = Math.random() * 360;
            const totalRotation = (spins * 360) + finalAngle;
            
            wheel.style.transform = 'rotate(' + totalRotation + 'deg)';
            
            setTimeout(function() {
                const selectedTeam = getSelectedTeam(finalAngle);
                
                result.innerHTML = 'üèÄ <span style="color: ' + selectedTeam.color_primary + '">' + selectedTeam.name + '</span> üèÄ';
                
                document.getElementById('popupResult').innerHTML = 'The wheel landed on:<br><br><strong style="color: ' + selectedTeam.color_primary + '; font-size: 1.5em;">' + selectedTeam.name + '</strong>';
                
                // Add celebration effects
                const popup = document.getElementById('popup');
                popup.classList.add('celebration-popup');
                popup.style.display = 'block';
                
                // Create confetti effect
                VisualEffects.createConfetti();
                
                // Create floating text effect
                VisualEffects.createFloatingText('üéâ ' + selectedTeam.name + '! üéâ', wheel.parentElement, selectedTeam.color_primary);
                
                // Play celebration sound
                SoundManager.playCelebrationSound();
                
                // Remove spinning glow effect
                wheel.parentElement.classList.remove('spinning-glow');
                
                spinButton.disabled = false;
                spinButton.textContent = 'üéØ SPIN AGAIN! üéØ';
                gameState.isSpinning = false;
            }, 3000);
        }
        
        // Dream team wheel spin
        function spinForDreamTeam() {
            if (gameState.isSpinning) return;
            
            gameState.isSpinning = true;
            const spinButton = document.getElementById('dreamSpinButton');
            const result = document.getElementById('dream-result');
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const wheel = document.getElementById('wheel-dream');
            
            spinButton.disabled = true;
            spinButton.textContent = 'Spinning...';
            result.textContent = `üéØ ${currentPlayer.name} is spinning for their next player... üéØ`;
            
            // Play spinning sound
            SoundManager.playSpinSound();
            
            // Add spinning glow effect
            wheel.parentElement.classList.add('spinning-glow');
            
            const spins = Math.floor(Math.random() * 5) + 5;
            const finalAngle = Math.random() * 360;
            const totalRotation = (spins * 360) + finalAngle;
            
            wheel.style.transform = 'rotate(' + totalRotation + 'deg)';
            
            setTimeout(function() {
                const selectedTeam = getSelectedTeam(finalAngle);
                gameState.currentTeam = selectedTeam;
                
                result.innerHTML = `üèÄ ${currentPlayer.name} landed on <span style="color: ${selectedTeam.color_primary}">${selectedTeam.name}</span>! üèÄ`;
                
                // Add celebration effects
                VisualEffects.createConfetti();
                
                // Create floating text effect
                VisualEffects.createFloatingText(`üéâ ${selectedTeam.name}! üéâ`, wheel.parentElement, selectedTeam.color_primary);
                
                // Play celebration sound
                SoundManager.playCelebrationSound();
                
                // Remove spinning glow effect
                wheel.parentElement.classList.remove('spinning-glow');
                
                // Show player selection
                showPlayerSelection(selectedTeam);
                
                spinButton.disabled = false;
                spinButton.textContent = 'üéØ SPIN FOR PLAYER! üéØ';
                gameState.isSpinning = false;
            }, 3000);
        }
        
        // Get selected team based on angle
        function getSelectedTeam(finalAngle) {
            const normalizedAngle = (360 - (finalAngle % 360)) % 360;
            const sectionAngle = 360 / nbaTeams.length;
            const selectedIndex = Math.floor(normalizedAngle / sectionAngle);
            return nbaTeams[selectedIndex];
        }

        // Show player selection interface
        function showPlayerSelection(team) {
            const playerSelection = document.getElementById('playerSelection');
            const teamNameSpan = document.getElementById('selectedTeamName');
            const dropdown = document.getElementById('playerDropdown');
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            
            // Update the selection header
            const selectionHeader = playerSelection.querySelector('h3');
            selectionHeader.textContent = `üèÄ ${currentPlayer.name}, Select Your Player!`;
            
            teamNameSpan.textContent = team.name;
            teamNameSpan.style.color = team.color_primary;
            
            // Clear dropdown
            dropdown.innerHTML = '<option value="">Loading players...</option>';
            
            // Debug: Show what team data we have
            console.log("üîç DEBUG: Selected team:", team);
            console.log("üîç DEBUG: Available teams count:", nbaTeams.length);
            console.log("üîç DEBUG: First few team names:", nbaTeams.slice(0, 5).map(t => t.name));
            
            // Load players for this team
            loadPlayersForTeam(team)
                .then(players => {
                    gameState.currentPlayers = players;
                    populatePlayerDropdown(players);
                    updatePositionButtons(); // Update buttons after loading players
                })
                .catch(error => {
                    console.error('Error loading players:', error);
                    // Use mock data as fallback
                    const mockPlayers = generateMockPlayers(team.name);
                    gameState.currentPlayers = mockPlayers;
                    populatePlayerDropdown(mockPlayers);
                    updatePositionButtons(); // Update buttons after loading players
                });
            
            playerSelection.classList.add('show');
        }

        // Load players for a team
        async function loadPlayersForTeam(team) {
            try {
                console.log("üèÄ Loading players for team:", team.name);
                
                // First check if we have the team data in our loaded nbaTeams array
                const fullTeamData = nbaTeams.find(t => t.name === team.name);
                
                if (fullTeamData && fullTeamData.roster && fullTeamData.roster.length > 0) {
                    console.log("‚úÖ Using pre-loaded roster data for", team.name, "- Found", fullTeamData.roster.length, "roster members");
                    console.log("üèÜ Sample player:", fullTeamData.roster[0]);
                    
                    // Include all roster members (players and coaches)
                    return fullTeamData.roster.map(player => ({
                        id: player.number || Math.random(),
                        first_name: player.name.split(' ')[0] || '',
                        last_name: player.name.split(' ').slice(1).join(' ') || '',
                        position: player.position,
                        height_feet: player.height ? parseInt(player.height.split("'")[0]) : null,
                        height_inches: player.height ? parseInt(player.height.split("'")[1]) : null,
                        weight_pounds: player.weight ? parseInt(player.weight.replace(' lbs', '')) : null,
                        team: { full_name: team.name },
                        number: player.number,
                        experience: player.experience,
                        full_name: player.name,
                        isCoach: player.position.includes('Coach') || player.position.includes('Head Coach')
                    }));
                }
                
                // If no roster data in loaded teams, try to load from JSON file
                console.log("üìÑ Loading from JSON file...");
                const response = await fetch('data/nba_teams_data.json');
                const data = await response.json();
                
                // Find the team in our data
                const teamData = data.teams.find(t => t.name === team.name);
                console.log("üîç Found team data:", teamData ? "Yes" : "No");
                
                if (teamData && teamData.roster) {
                    console.log("‚úÖ Found roster data in JSON for", team.name, "- Found", teamData.roster.length, "roster members");
                    console.log("üèÜ Sample player:", teamData.roster[0]);
                    
                    // Include all roster members (players and coaches)
                    return teamData.roster.map(player => ({
                        id: player.number || Math.random(),
                        first_name: player.name.split(' ')[0] || '',
                        last_name: player.name.split(' ').slice(1).join(' ') || '',
                        position: player.position,
                        height_feet: player.height ? parseInt(player.height.split("'")[0]) : null,
                        height_inches: player.height ? parseInt(player.height.split("'")[1]) : null,
                        weight_pounds: player.weight ? parseInt(player.weight.replace(' lbs', '')) : null,
                        team: { full_name: team.name },
                        number: player.number,
                        experience: player.experience,
                        full_name: player.name,
                        isCoach: player.position.includes('Coach') || player.position.includes('Head Coach')
                    }));
                }
                
                // Fallback to mock data
                console.log("‚ö†Ô∏è No roster data found, using mock data for", team.name);
                console.log("üîç Available teams in data:", data.teams ? data.teams.map(t => t.name) : "No teams data");
                return generateMockPlayers(team.name);
            } catch (error) {
                console.error('‚ùå Error loading team players:', error);
                return generateMockPlayers(team.name);
            }
        }

        // Generate mock players for demonstration
        function generateMockPlayers(teamName) {
            const firstNames = ['James', 'Kevin', 'Stephen', 'LeBron', 'Kawhi', 'Giannis', 'Luka', 'Damian', 'Russell', 'Chris', 'Paul', 'Anthony', 'Kyrie', 'Joel', 'Nikola'];
            const lastNames = ['Johnson', 'Williams', 'Brown', 'Davis', 'Miller', 'Wilson', 'Moore', 'Taylor', 'Anderson', 'Thomas', 'Jackson', 'White', 'Harris', 'Martin', 'Thompson'];
            const positions = ['Guard', 'Forward', 'Center', 'Guard-Forward', 'Forward-Center'];
            
            const players = [];
            for (let i = 0; i < 12; i++) {
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const position = positions[Math.floor(Math.random() * positions.length)];
                
                players.push({
                    id: i + 1,
                    first_name: firstName,
                    last_name: lastName,
                    position: position,
                    height_feet: Math.floor(Math.random() * 2) + 6,
                    height_inches: Math.floor(Math.random() * 12),
                    weight_pounds: Math.floor(Math.random() * 50) + 180,
                    team: { full_name: teamName }
                });
            }
            
            return players;
        }

        // Populate player dropdown
        function populatePlayerDropdown(players) {
            const dropdown = document.getElementById('playerDropdown');
            dropdown.innerHTML = '<option value="">Choose a player...</option>';
            
            console.log("üéØ Populating dropdown with", players.length, "roster members");
            console.log("üèÜ First player:", players[0]);
            
            // Separate players and coaches
            const playersOnly = players.filter(p => !p.isCoach);
            const coaches = players.filter(p => p.isCoach);
            
            // Add players first
            if (playersOnly.length > 0) {
                const playerGroup = document.createElement('optgroup');
                playerGroup.label = 'Players';
                
                playersOnly.forEach((player, index) => {
                    const option = document.createElement('option');
                    option.value = players.indexOf(player); // Use original index
                    
                    const playerName = player.full_name || `${player.first_name} ${player.last_name}`;
                    const number = player.number ? `#${player.number}` : '';
                    const position = player.position || 'Unknown';
                    
                    option.textContent = `${playerName} ${number} - ${position}`;
                    playerGroup.appendChild(option);
                });
                
                dropdown.appendChild(playerGroup);
            }
            
            // Add coaches
            if (coaches.length > 0) {
                const coachGroup = document.createElement('optgroup');
                coachGroup.label = 'Coaches';
                
                coaches.forEach((coach, index) => {
                    const option = document.createElement('option');
                    option.value = players.indexOf(coach); // Use original index
                    
                    const coachName = coach.full_name || `${coach.first_name} ${coach.last_name}`;
                    const position = coach.position || 'Coach';
                    
                    option.textContent = `${coachName} - ${position}`;
                    coachGroup.appendChild(option);
                });
                
                dropdown.appendChild(coachGroup);
            }
            
            console.log("‚úÖ Dropdown populated with", playersOnly.length, "players and", coaches.length, "coaches");
        }

        // Update position buttons based on filled positions and selected player
        function updatePositionButtons() {
            const dropdown = document.getElementById('playerDropdown');
            const selectedIndex = dropdown.value;
            
            if (selectedIndex === '') {
                // No player selected, disable all buttons
                document.querySelectorAll('.position-btn').forEach(btn => {
                    btn.disabled = true;
                });
                return;
            }
            
            const selectedPlayer = gameState.currentPlayers[selectedIndex];
            const currentTeam = gameState.dreamTeams[gameState.currentPlayerIndex];
            
            // Check which positions this player can fill
            const buttons = document.querySelectorAll('.position-btn');
            buttons.forEach(btn => {
                const position = btn.onclick.toString().match(/assignPlayer\('(.+?)'\)/)[1];
                const isPositionFilled = currentTeam[position] !== null;
                const canFillPosition = canPlayerFillPosition(selectedPlayer, position);
                
                btn.disabled = isPositionFilled || !canFillPosition;
                btn.style.opacity = btn.disabled ? '0.5' : '1';
            });
        }
        
        // Check if a player can fill a specific position
        function canPlayerFillPosition(player, position) {
            if (player.isCoach) {
                return position === 'coach';
            }
            
            // For 6th and 7th man, any non-coach can fill
            if (position === 'sixth' || position === 'seventh') {
                return true;
            }
            
            // For coach position, only coaches can fill
            if (position === 'coach') {
                return false;
            }
            
            // For specific positions, check if player's position matches
            const playerPosition = player.position.toLowerCase();
            const positionMap = {
                'pg': ['point guard', 'guard'],
                'sg': ['shooting guard', 'guard'],
                'sf': ['small forward', 'forward'],
                'pf': ['power forward', 'forward'],
                'c': ['center']
            };
            
            const validPositions = positionMap[position] || [];
            return validPositions.some(pos => playerPosition.includes(pos));
        }
        
        // Add dropdown change listener
        document.addEventListener('DOMContentLoaded', function() {
            const dropdown = document.getElementById('playerDropdown');
            if (dropdown) {
                dropdown.addEventListener('change', updatePositionButtons);
            }
        });

        // Assign player to position
        function assignPlayer(position) {
            const dropdown = document.getElementById('playerDropdown');
            const selectedIndex = dropdown.value;
            
            if (selectedIndex === '') {
                alert('Please select a player first!');
                return;
            }
            
            const player = gameState.currentPlayers[selectedIndex];
            
            // Check if player can fill this position
            if (!canPlayerFillPosition(player, position)) {
                alert(`${player.full_name || player.first_name + ' ' + player.last_name} cannot fill the ${position} position!`);
                return;
            }
            
            // Assign player to current player's team
            gameState.dreamTeams[gameState.currentPlayerIndex][position] = player;
            
            // Update UI
            const slot = document.getElementById(`slot-${position}`);
            const playerDiv = slot.querySelector('.position-player');
            playerDiv.textContent = player.full_name || `${player.first_name} ${player.last_name}`;
            playerDiv.classList.add('filled');
            slot.classList.add('filled');
            
            // Play success sound
            SoundManager.playSuccessSound();
            
            // Hide player selection
            document.getElementById('playerSelection').classList.remove('show');
            
            // Move to next player's turn
            nextPlayerTurn();
        }
        
        // Move to next player's turn
        function nextPlayerTurn() {
            // Move to next player
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.numPlayers;
            
            // If we've completed a full round, increment round counter
            if (gameState.currentPlayerIndex === 0) {
                gameState.currentRound++;
            }
            
            // Check if all teams are complete
            if (gameState.currentRound > gameState.maxRounds) {
                // All teams complete, start battle phase
                startBattlePhase();
                return;
            }
            
            // Update display for next player
            updateMultiplayerDisplay();
            
            // Re-enable spin button
            document.getElementById('dreamSpinButton').disabled = false;
            document.getElementById('dreamSpinButton').textContent = 'üéØ SPIN FOR PLAYER! üéØ';
        }

        // Start battle phase
        function startBattlePhase() {
            gameState.phase = 'battle';
            
            // Show battle section
            document.getElementById('battleSection').style.display = 'block';
            
            // Update battle section content
            const battleSection = document.getElementById('battleSection');
            battleSection.innerHTML = `
                <h3>üî• All Teams Complete! üî•</h3>
                <p>All ${gameState.numPlayers} players have built their dream teams!</p>
                <div class="team-summary">
                    ${gameState.players.map((player, index) => `
                        <div class="team-card">
                            <h4>${player.name}'s Team</h4>
                            <div class="team-positions">
                                ${Object.entries(gameState.dreamTeams[index])
                                    .filter(([pos, player]) => player !== null)
                                    .map(([pos, player]) => `
                                        <div class="position-summary">
                                            <strong>${pos.toUpperCase()}:</strong> ${player.full_name || player.first_name + ' ' + player.last_name}
                                        </div>
                                    `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
                <button class="battle-button" onclick="startBattle()">‚öîÔ∏è START BATTLE! ‚öîÔ∏è</button>
            `;
            
            // Disable spin button
            document.getElementById('dreamSpinButton').disabled = true;
            document.getElementById('dreamSpinButton').textContent = 'All Teams Complete!';
        }

        // Start battle
        function startBattle() {
            alert('üî• Battle feature coming soon! Your dream team is ready to dominate! üèÜ');
        }

        // Reset multiplayer game (for new game)
        function resetMultiplayerGame() {
            gameState.phase = 'setup';
            gameState.players = [];
            gameState.dreamTeams = [];
            gameState.currentPlayerIndex = 0;
            gameState.currentRound = 1;
            
            // Show setup phase
            document.getElementById('setup-phase').style.display = 'block';
            document.getElementById('mode-selection').style.display = 'none';
            document.getElementById('classic-mode').style.display = 'none';
            document.getElementById('dream-team-mode').style.display = 'none';
            
            // Reset setup steps
            document.getElementById('player-count-step').style.display = 'block';
            document.getElementById('player-names-step').style.display = 'none';
            document.querySelectorAll('.count-button').forEach(btn => btn.classList.remove('selected'));
            
            // Reset UI
            document.getElementById('battleSection').style.display = 'none';
            document.getElementById('dreamSpinButton').disabled = false;
            document.getElementById('dreamSpinButton').textContent = 'üéØ SPIN FOR PLAYER! üéØ';
            document.getElementById('playerSelection').classList.remove('show');
            
            // Reset all slots
            document.querySelectorAll('.position-slot').forEach(slot => {
                slot.classList.remove('filled');
                const playerDiv = slot.querySelector('.position-player');
                playerDiv.textContent = 'Empty';
                playerDiv.classList.remove('filled');
            });
        }

        // Close popup
        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }
    </script>
    
    <!-- Developer Tools Section -->
    <div style="margin-top: 50px; padding: 20px; background: #f5f5f5; border-top: 2px solid #ddd; text-align: center;">
        <details>
            <summary style="cursor: pointer; font-weight: bold; color: #666; margin-bottom: 10px;">
                üîß Developer Tools (Click to expand)
            </summary>
            <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button onclick="testDataLoading()" style="padding: 8px 16px; background: #ff9800; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                    üîç Test Data Loading
                </button>
                <button onclick="testDirectJSONLoad()" style="padding: 8px 16px; background: #e91e63; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                    üìÑ Test JSON File
                </button>
                <button onclick="testNBA2K25Database()" style="padding: 8px 16px; background: #9C27B0; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                    üèÜ Test NBA 2K25 DB
                </button>
                <button onclick="testAtlantaHawks()" style="padding: 8px 16px; background: #E03A3E; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                    üèÄ Test Hawks Team
                </button>
                <button onclick="testBattleSystem()" style="padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                    ‚öîÔ∏è Test Battle System
                </button>
            </div>
            <p style="font-size: 11px; color: #888; margin-top: 10px;">
                These tools are for testing and debugging. Check browser console for detailed results.
            </p>
        </details>
    </div>
    
    <!-- NBA 2K25 Battle System Integration -->
    <script src="database/nba/lookup-functions/player-rating-lookup.js"></script>
    <script src="database/shared/battle-system-integration.js"></script>
    
    <!-- Battle System Enhancement -->
    <script>
        // Enhanced Battle System for NBA 2K25 Ratings
        let battleSystemManager = null;
        
        // Initialize battle system when page loads
        window.addEventListener('load', async () => {
            try {
                battleSystemManager = new EnhancedBattleSystemManager();
                await battleSystemManager.initialize();
                console.log('üéÆ NBA 2K25 Battle System Ready!');
            } catch (error) {
                console.warn('‚ö†Ô∏è Battle System initialization failed, using fallback:', error);
            }
        });

        // Enhanced start battle function with NBA 2K25 ratings
        function startBattle() {
            if (!battleSystemManager || !battleSystemManager.initialized) {
                alert('üî• Battle system loading... Please wait a moment and try again!');
                return;
            }
            
            if (gameState.dreamTeams.length < 2) {
                alert('Need at least 2 teams to battle!');
                return;
            }
            
            // Set up team objects for battle
            const team1 = {
                playerName: gameState.players[0].name,
                ...gameState.dreamTeams[0]
            };
            
            const team2 = {
                playerName: gameState.players[1].name,
                ...gameState.dreamTeams[1]
            };
            
            // Conduct the battle using NBA 2K25 ratings
            console.log('üéØ Starting NBA 2K25 battle between:', team1.playerName, 'vs', team2.playerName);
            
            const battleResult = battleSystemManager.conductDetailedBattle(team1, team2);
            
            if (battleResult) {
                displayBattleResult(battleResult);
            } else {
                // Fallback to simple battle
                const winner = Math.random() > 0.5 ? team1 : team2;
                alert(`üèÜ ${winner.playerName} wins! Great team building!`);
            }
        }
        
        // Display detailed battle results
        function displayBattleResult(battleResult) {
            const battleSection = document.getElementById('battleSection');
            
            const team1 = battleResult.teams.team1;
            const team2 = battleResult.teams.team2;
            const winner = battleResult.winner;
            
            battleSection.innerHTML = `
                <div class="battle-results">
                    <h2>üèÜ Battle Results üèÜ</h2>
                    
                    <div class="battle-summary">
                        <h3>${winner.name} Wins!</h3>
                        <p><strong>Battle Type:</strong> ${battleResult.battleType}</p>
                        <p><strong>Victory Margin:</strong> ${battleResult.margin} points</p>
                    </div>
                    
                    <div class="team-comparison">
                        <div class="team-result">
                            <h4>${team1.name}</h4>
                            <div class="team-score">‚≠ê ${team1.rating.total}</div>
                            <div class="team-breakdown">
                                <p><strong>Starters:</strong> ${team1.rating.breakdown.starterTotal}</p>
                                <p><strong>Bench:</strong> ${Math.round(team1.rating.breakdown.benchTotal)}</p>
                                <p><strong>Chemistry:</strong> ${team1.rating.breakdown.chemistry}</p>
                                <p><strong>Bonuses:</strong> ${team1.rating.breakdown.bonuses}</p>
                            </div>
                        </div>
                        
                        <div class="vs-divider">VS</div>
                        
                        <div class="team-result">
                            <h4>${team2.name}</h4>
                            <div class="team-score">‚≠ê ${team2.rating.total}</div>
                            <div class="team-breakdown">
                                <p><strong>Starters:</strong> ${team2.rating.breakdown.starterTotal}</p>
                                <p><strong>Bench:</strong> ${Math.round(team2.rating.breakdown.benchTotal)}</p>
                                <p><strong>Chemistry:</strong> ${team2.rating.breakdown.chemistry}</p>
                                <p><strong>Bonuses:</strong> ${team2.rating.breakdown.bonuses}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="position-battles">
                        <h4>ü•ä Position Battles:</h4>
                        ${battleResult.positionBattles ? 
                            Object.entries(battleResult.positionBattles).map(([pos, battle]) => `
                                <div class="position-battle">
                                    <span class="position">${pos.toUpperCase()}:</span>
                                    <span class="battle-result">${battle.team1.name} (${battle.team1.rating}) vs ${battle.team2.name} (${battle.team2.rating})</span>
                                    <span class="battle-winner">Winner: ${battle.winner.name}</span>
                                </div>
                            `).join('') : ''
                        }
                    </div>
                    
                    <div class="battle-analysis">
                        <h4>üìä Battle Analysis:</h4>
                        <p>${battleResult.summary}</p>
                    </div>
                    
                    <div class="battle-actions">
                        <button onclick="startBattle()" class="battle-button">‚öîÔ∏è BATTLE AGAIN! ‚öîÔ∏è</button>
                        <button onclick="resetMultiplayerGame()" class="battle-button secondary">üîÑ New Game</button>
                    </div>
                </div>
            `;
        }
        
        // Test battle system
        function testBattleSystem() {
            console.log('üß™ Testing Battle System...');
            
            // Create mock teams for testing
            const testTeam1 = {
                playerName: 'George',
                pg: { name: 'Stephen Curry' },
                sg: { name: 'Klay Thompson' },
                sf: { name: 'Kevin Durant' },
                pf: { name: 'Draymond Green' },
                c: { name: 'Nikola Jokic' },
                sixth: { name: 'Jordan Poole' },
                seventh: { name: 'Andrew Wiggins' }
            };
            
            const testTeam2 = {
                playerName: 'Frankie',
                pg: { name: 'Luka Doncic' },
                sg: { name: 'Kyrie Irving' },
                sf: { name: 'LeBron James' },
                pf: { name: 'Anthony Davis' },
                c: { name: 'Joel Embiid' },
                sixth: { name: 'Russell Westbrook' },
                seventh: { name: 'Carmelo Anthony' }
            };
            
            if (battleSystemManager && battleSystemManager.initialized) {
                const result = battleSystemManager.conductDetailedBattle(testTeam1, testTeam2);
                console.log('üèÜ Battle Result:', result);
                displayBattleResult(result);
            } else {
                console.log('‚ö†Ô∏è Battle system not ready yet');
            }
        }
    </script>
    
    <script src="setup-pwa.js"></script>
</body>
</html>
